<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portuguese Master 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --pt-blue: #0026a1; --pt-white: #ffffff; --pt-red: #da121a; }
        body { background-color: #f0f4f8; font-family: 'Inter', sans-serif; color: #1a365d; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05); }
        .tab-btn { transition: all 0.2s; border-bottom: 4px solid transparent; opacity: 0.5; }
        .tab-active { border-bottom-color: var(--pt-blue); opacity: 1; font-weight: 900; color: var(--pt-blue); }
        .pronoun-bubble { font-size: 10px; font-weight: 900; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase; }
        .correct { color: #10b981 !important; border-color: #10b981 !important; background: #ecfdf5; }
        .wrong { color: #ef4444 !important; border-color: #ef4444 !important; background: #fef2f2; }
    </style>
</head>
<body class="p-4 md:p-12">

    <header class="max-w-6xl mx-auto mb-12 flex flex-col md:flex-row justify-between items-center gap-6">
        <div>
            <h1 class="text-4xl font-black tracking-tighter text-blue-900 flex items-center gap-3">
                <span class="text-5xl">üáµüáπ</span> PT MASTER COACH
            </h1>
            <p class="text-blue-600 font-medium">Smart Conjugation Patterns for Grade 3+</p>
        </div>
        <nav class="flex gap-10">
            <button onclick="switchView('rules')" id="nav-rules" class="tab-btn tab-active py-2">Rules Engine</button>
            <button onclick="switchView('practice')" id="nav-practice" class="tab-btn py-2">Challenge Mode</button>
            <button onclick="switchView('dict')" id="nav-dict" class="tab-btn py-2">Mini Dict</button>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto">
        
        <!-- SECTION 1: RULES ENGINE -->
        <div id="view-rules" class="space-y-10">
            <section class="glass-card p-10">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-8">Step 1: Select Verb Type</h2>
                <div class="grid grid-cols-3 gap-6 mb-12 text-center text-4xl font-black">
                    <button onclick="setEnding('ar')" id="end-ar" class="p-10 rounded-3xl bg-blue-50 text-blue-700 shadow-sm border-4 border-transparent">-AR</button>
                    <button onclick="setEnding('er')" id="end-er" class="p-10 rounded-3xl bg-emerald-50 text-emerald-700 shadow-sm border-4 border-transparent">-ER</button>
                    <button onclick="setEnding('ir')" id="end-ir" class="p-10 rounded-3xl bg-rose-50 text-rose-700 shadow-sm border-4 border-transparent">-IR</button>
                </div>
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6">Step 2: Select Tense</h2>
                <div id="tense-buttons" class="flex flex-wrap gap-3"></div>
            </section>

            <div id="rules-output" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div class="glass-card p-10 border-2 border-blue-50">
                    <div id="rules-list" class="space-y-4"></div>
                </div>
                <div id="examples-output" class="space-y-4"></div>
            </div>
        </div>

        <!-- SECTION 2: CHALLENGE MODE -->
        <div id="view-practice" class="hidden glass-card p-10 text-center">
            <h2 class="text-3xl font-black text-blue-900 mb-4">Verb Challenge üèÜ</h2>
            <p class="text-slate-400 mb-10">Can you complete the conjugation? Type the correct ending!</p>
            <div id="quiz-container" class="space-y-6 max-w-md mx-auto"></div>
            <button onclick="checkAnswers()" class="mt-10 px-12 py-4 bg-blue-900 text-white font-black rounded-2xl uppercase tracking-widest hover:bg-blue-800 transition-colors shadow-xl">Check Answers</button>
        </div>

        <!-- SECTION 3: MINI DICTIONARY -->
        <div id="view-dict" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>

    </main>

    <script>
        let db = null, activeEnd = null, activeTense = null;
        const audio = new Audio();
        const synth = window.speechSynthesis;

        async function start() {
            const r = await fetch('portuguese.json?v='+Date.now());
            db = await r.json();
            
            const tb = document.getElementById('tense-buttons');
            tb.innerHTML = db.modules.map(m => `<button onclick="setTense('${m.tense}', this)" class="tense-btn px-8 py-4 bg-white rounded-2xl font-bold text-sm shadow-sm hover:border-blue-200 transition-all uppercase">${m.tense}</button>`).join('');
            
            document.getElementById('view-dict').innerHTML = db.verbs.map(v => `
                <div class="glass-card p-6 border border-slate-100 cursor-pointer hover:border-blue-200 transition-all" onclick="speak('${v.word}')">
                    <div class="flex justify-between items-center mb-2"><span class="text-xl font-black text-blue-900">${v.word}</span><span class="text-[9px] font-bold px-2 py-0.5 bg-slate-100 rounded uppercase">-${v.type}</span></div>
                    <p class="text-xs text-slate-400 italic">${v.meaning}</p>
                </div>
            `).join('');
        }

        function switchView(id) {
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('view-' + id).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
            document.getElementById('nav-' + id).classList.add('tab-active');
            if (id === 'practice') loadQuiz();
        }

        function setEnding(end) {
            activeEnd = end;
            document.querySelectorAll('[id^=end-]').forEach(b => b.style.borderColor = 'transparent');
            document.getElementById('end-' + end).style.borderColor = '#0026a1';
            updateUI();
        }

        function setTense(t, btn) {
            activeTense = t;
            document.querySelectorAll('.tense-btn').forEach(b => b.classList.remove('bg-blue-900', 'text-white'));
            btn.classList.add('bg-blue-900', 'text-white');
            updateUI();
        }

        function updateUI() {
            if(!activeEnd || !activeTense) return;
            document.getElementById('rules-output').classList.remove('hidden');
            const key = activeTense.includes('ÁèæÂú®') ? 'presente' : (activeTense.includes('ÈÅéÂéª') ? 'preterito' : 'futuro');
            const rules = db.regular_rules[activeEnd][key];
            const pronouns = [["Eu"], ["Tu"], ["Ele", "Ela", "Voc√™"], ["N√≥s"], ["Eles", "Elas", "Voc√™s"]];
            
            document.getElementById('rules-list').innerHTML = pronouns.map((p, i) => `
                <div class="flex justify-between items-center p-5 bg-slate-50/50 rounded-2xl border border-slate-100">
                    <div class="flex flex-wrap gap-1 max-w-[150px] font-bold text-slate-400 text-[9px] uppercase">${p.join(' ¬∑ ')}</div>
                    <button onclick="speak('${rules[i]}')" class="text-2xl font-black text-blue-900">‚Äî<span class="text-red-500 underline decoration-2">${rules[i]}</span> üîä</button>
                </div>
            `).join('');

            const ex = db.modules.find(m => m.tense === activeTense).examples;
            document.getElementById('examples-output').innerHTML = ex.map(e => `<div class="glass-card p-6 flex justify-between items-start gap-4 border border-slate-50" onclick="speak('${e.pt.replace(/'/g,"\\'")}')"><div><p class="text-lg font-bold">${e.pt}</p><p class="text-[10px] text-slate-400 italic mt-2">${e.en}</p></div><span class="bg-blue-900 text-white p-2 rounded-full text-xs shadow-lg">üîä</span></div>`).join('');
        }

        function loadQuiz() {
            const ends = ['ar', 'er', 'ir'];
            const tenses = ['presente', 'preterito', 'futuro'];
            const e = ends[Math.floor(Math.random()*3)];
            const t = tenses[Math.floor(Math.random()*3)];
            const rules = db.regular_rules[e][t];
            const pronouns = ["Eu", "Tu", "Ele/Ela", "N√≥s", "Eles/Elas"];
            
            document.getElementById('quiz-container').innerHTML = `
                <div class="bg-blue-50 p-4 rounded-xl mb-6 font-bold text-blue-700 uppercase tracking-tighter">Level: ${e.toUpperCase()} - ${t.toUpperCase()}</div>
                ${pronouns.map((p, i) => `
                    <div class="flex items-center gap-4 bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <span class="w-20 text-left font-black text-slate-400 uppercase text-xs">${p}</span>
                        <span class="text-xl font-bold text-blue-900">Verb‚Äî</span>
                        <input type="text" data-ans="${rules[i]}" class="quiz-input flex-grow p-2 border-b-4 border-slate-100 outline-none text-xl font-black text-blue-600 uppercase" placeholder="...">
                    </div>
                `).join('')}
            `;
        }

        function checkAnswers() {
            document.querySelectorAll('.quiz-input').forEach(i => {
                if (i.value.toLowerCase().trim() === i.getAttribute('data-ans')) { i.classList.add('correct'); }
                else { i.classList.add('wrong'); i.value = i.value + " ‚ùå (Ans: "+i.getAttribute('data-ans')+")"; }
            });
        }

        // üîä HYBRID AUDIO CORE
        function speak(txt) {
            audio.pause();
            audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=pt-PT&q=${encodeURIComponent(txt)}`;
            const p = audio.play();
            if(p !== undefined) p.catch(() => { synth.cancel(); const u = new SpeechSynthesisUtterance(txt); u.lang='pt-PT'; u.rate=0.8; synth.speak(u); });
        }

        start();
    </script>
</body>
</html>

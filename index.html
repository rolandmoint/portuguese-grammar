<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portuguese Verb Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --pt-blue: #0026a1; --pt-white: #ffffff; --pt-red: #da121a; }
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; color: #1e293b; min-height: 100vh; }
        .control-panel { background: white; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,38,161,0.05); }
        .tense-btn { transition: all 0.2s; border: 2px solid transparent; }
        .tense-btn:hover { border-color: var(--pt-blue); }
        .tense-btn.active { background-color: var(--pt-blue); color: white; transform: scale(1.05); }
        .ending-btn { transition: all 0.2s; }
        .ending-active { outline: 4px solid var(--pt-blue); outline-offset: 4px; }
        .example-card { border-left: 4px solid #e2e8f0; transition: border-color 0.2s; }
        .example-card:hover { border-left-color: var(--pt-blue); background: #f1f5f9; }
        .suffix-highlight { color: var(--pt-red); font-weight: 900; text-decoration: underline; }
    </style>
</head>
<body class="p-4 md:p-12">

    <header class="max-w-5xl mx-auto mb-12 flex flex-col md:flex-row justify-between items-center gap-6">
        <div>
            <h1 class="text-4xl font-black tracking-tighter text-blue-900 flex items-center gap-3 italic">
                <span class="text-5xl">ðŸ‡µðŸ‡¹</span> PORTUGUESE VERB ENGINE
            </h1>
            <p class="text-blue-600 font-medium mt-1">Efficient Patterns for regular -AR / -ER / -IR verbs</p>
        </div>
        <div class="text-right font-mono text-[10px] text-slate-400 uppercase tracking-widest leading-tight">
            Learning Phase 2.5<br>Bilingual Support Active
        </div>
    </header>

    <main class="max-w-5xl mx-auto space-y-10">
        
        <!-- âš™ï¸ ENGINE CONTROLS -->
        <section class="control-panel p-8">
            <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6">1. Choose Verb Ending</h2>
            <div class="grid grid-cols-3 gap-6 mb-10">
                <button onclick="pickEnding('ar')" id="end-ar" class="ending-btn p-10 rounded-3xl bg-blue-50 text-blue-700 text-4xl font-black shadow-inner">-AR</button>
                <button onclick="pickEnding('er')" id="end-er" class="ending-btn p-10 rounded-3xl bg-emerald-50 text-emerald-700 text-4xl font-black shadow-inner">-ER</button>
                <button onclick="pickEnding('ir')" id="end-ir" class="ending-btn p-10 rounded-3xl bg-rose-50 text-rose-700 text-4xl font-black shadow-inner">-IR</button>
            </div>

            <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6">2. Choose Tense</h2>
            <div class="flex flex-wrap gap-3" id="tense-selector">
                <!-- Tenses will be injected here -->
            </div>
        </section>

        <!-- ðŸ“Š CONJUGATION DISPLAY -->
        <section id="results" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-10">
            
            <!-- Conjugation Table -->
            <div class="bg-white p-8 rounded-3xl border-2 border-blue-50 shadow-sm">
                <h2 id="result-tense-name" class="text-2xl font-black text-blue-900 mb-6 uppercase tracking-tighter"></h2>
                <div class="space-y-3" id="conjugation-list">
                    <!-- Conjugations here -->
                </div>
            </div>

            <!-- Example List -->
            <div class="space-y-4">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-4">Practical Context (5 Examples)</h2>
                <div id="example-list" class="space-y-3">
                    <!-- Examples here -->
                </div>
            </div>

        </section>

    </main>

    <footer class="max-w-5xl mx-auto mt-20 py-12 border-t border-slate-200 text-center text-slate-400 text-[10px] font-bold uppercase tracking-widest">
        Automated Language Lab â€¢ End-to-End Encryption
    </footer>

    <script>
        let db = null;
        let selectedEnding = null;
        let selectedTense = null;
        const audio = new Audio();

        async function init() {
            try {
                const res = await fetch('portuguese.json');
                db = await res.json();
                renderTenseSelector();
            } catch (e) { document.body.innerHTML = "DATA_LOAD_FAIL"; }
        }

        function renderTenseSelector() {
            const container = document.getElementById('tense-selector');
            container.innerHTML = db.modules.map(m => `
                <button onclick="pickTense('${m.tense}')" class="tense-btn px-6 py-3 rounded-2xl bg-white text-slate-600 font-bold text-sm shadow-sm">
                    ${m.tense}
                </button>
            `).join('');
        }

        function pickEnding(end) {
            selectedEnding = end;
            document.querySelectorAll('.ending-btn').forEach(b => b.classList.remove('ending-active'));
            document.getElementById('end-' + end).classList.add('ending-active');
            updateDisplay();
        }

        function pickTense(tense) {
            selectedTense = tense;
            document.querySelectorAll('.tense-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(tense)));
            updateDisplay();
        }

        function updateDisplay() {
            if (!selectedEnding || !selectedTense) return;
            document.getElementById('results').classList.remove('hidden');
            
            const module = db.modules.find(m => m.tense === selectedTense);
            const rules = db.regular_rules[selectedEnding][Object.keys(db.regular_rules[selectedEnding])[db.modules.indexOf(module)]];
            
            document.getElementById('result-tense-name').innerText = selectedTense;
            
            const pronouns = ["Eu", "Tu", "Ele/Ela", "NÃ³s", "Eles/Elas"];
            document.getElementById('conjugation-list').innerHTML = pronouns.map((p, i) => `
                <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl group border border-transparent hover:border-blue-200 transition-all">
                    <span class="font-bold text-slate-400 text-sm uppercase">${p}</span>
                    <button onclick="speak('Verbo-${rules[i]}')" class="text-xl font-black text-blue-900 flex items-center gap-2">
                        <span>â€”<span class="text-red-500 underline">${rules[i]}</span></span>
                        <span class="text-xs bg-white text-blue-400 p-1.5 rounded-full shadow-sm">ðŸ”Š</span>
                    </button>
                </div>
            `).join('');

            document.getElementById('example-list').innerHTML = module.examples.map(ex => `
                <div class="example-card bg-white p-5 rounded-2xl shadow-sm border border-slate-50">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-lg font-bold text-slate-800 leading-tight">${ex.pt}</p>
                        <button onclick="speak('${ex.pt.replace(/'/g,"\\'")}')" class="bg-blue-900 text-white rounded-full p-2 text-[10px] shadow-lg">ðŸ”Š</button>
                    </div>
                    <p class="text-xs text-slate-400 font-medium italic">${ex.en}</p>
                </div>
            `).join('');
        }

        // ðŸ”Š ROBUST TTS SYSTEM (Improved for all Browsers)
        function speak(text) {
            audio.pause();
            audio.currentTime = 0;
            // Using a more stable Google translate proxy for education
            audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=pt-PT&q=${encodeURIComponent(text)}`;
            
            audio.play().catch(e => {
                console.warn("Mobile autoplay block encountered. Audio requires explicit click.");
            });
        }

        init();
    </script>
</body>
</html>
